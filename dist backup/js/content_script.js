(()=>{"use strict";const e={inferRole(e,t){const n={button:"button",a:"link",img:"img",input:{button:"button",submit:"button",checkbox:"checkbox",radio:"radio",text:"textbox",email:"textbox",password:"textbox",search:"searchbox",number:"spinbutton"},select:"combobox",textarea:"textbox",h1:"heading",h2:"heading",h3:"heading",h4:"heading",h5:"heading",h6:"heading"},o=e.toLowerCase();return"input"===o&&t?n.input[t]||"textbox":n[o]||null},generateLocator(e){var t;const n=e.tagName.toLowerCase(),o=e.type,r=e.getAttribute("role")||this.inferRole(n,o),a=null===(t=e.innerText)||void 0===t?void 0:t.trim().substring(0,50),i=e.id,s=e.getAttribute("data-testid")||e.getAttribute("data-test-id"),l=e.getAttribute("aria-label"),c=e.placeholder,u=this.getLabelText(e);if(s)return`page.getByTestId('${s}')`;const d=l||u||a;if(r&&d)return`page.getByRole('${r}', { name: '${this.escape(d)}' })`;if(["input","textarea","select"].includes(n)&&u)return`page.getByLabel('${this.escape(u)}')`;if(c)return`page.getByPlaceholder('${this.escape(c)}')`;if(i)return`page.locator('#${i}')`;if(a&&a.length>0)return`page.getByText('${this.escape(a)}')`;const g=Array.from(e.classList).join(".");return g?`${n}.${g}`:n},getLabelText(e){if(e.id){const t=document.querySelector(`label[for="${e.id}"]`);if(t)return t.innerText.trim()}const t=e.closest("label");return t?t.innerText.trim():null},escape:e=>e.replace(/'/g,"\\'").replace(/\n/g," ").trim()};let t=!1,n=!1,o=null;function r(o){var r;if(!t||n)return;const a=o.target;if(!a)return;const i={type:o.type,locator:e.generateLocator(a),value:a.value,timestamp:Date.now(),tagName:a.tagName,innerText:null===(r=a.innerText)||void 0===r?void 0:r.trim().substring(0,50)};chrome.runtime.sendMessage({type:"RECORDED_STEP",step:i})}function a(e){o&&(o.style.outline="",o=null)}chrome.runtime.onMessage.addListener((e,o,r)=>("START_RECORDING"===e.type?(t=!0,console.log("Smart QA Recorder: Recording enabled")):"STOP_RECORDING"===e.type?(t=!1,n=!1,a(),console.log("Smart QA Recorder: Recording stopped")):"GET_PAGE_CONTEXT"===e.type?r({context:function(){const e=Array.from(document.querySelectorAll('button, a, input, select, textarea, [role="button"], h1, h2, h3')).slice(0,50).map(e=>{var t;const n=e;return{tagName:n.tagName,text:null===(t=n.innerText)||void 0===t?void 0:t.trim().substring(0,50),role:n.getAttribute("role"),placeholder:n.placeholder,id:n.id,type:n.type}});return{title:document.title,url:window.location.href,elements:e}}()}):"PING"===e.type&&r({pong:!0}),!0)),new MutationObserver(n=>{var o;if(t)for(const t of n)for(const n of t.addedNodes)if(n instanceof HTMLElement){const t=null===(o=n.innerText)||void 0===o?void 0:o.trim(),r=n.className;(/toast|message|notification|alert/i.test(r)||n.closest('[role="alert"]')||n.closest(".ant-message"))&&t&&chrome.runtime.sendMessage({type:"RECORDED_STEP",step:{type:"ASSERT_TEXT",locator:e.generateLocator(n),innerText:t.substring(0,100),timestamp:Date.now(),tagName:n.tagName,isToast:!0}})}}).observe(document.body,{childList:!0,subtree:!0}),document.addEventListener("click",function(o){var r,a;if(!t)return;const i=o.target;if(!i)return;if(n){o.preventDefault(),o.stopPropagation();const t=e.generateLocator(i),n=(null===(r=i.innerText)||void 0===r?void 0:r.trim())||"";chrome.runtime.sendMessage({type:"RECORDED_STEP",step:{type:"ASSERT_VISIBLE",locator:t,timestamp:Date.now(),tagName:i.tagName}}),n&&chrome.runtime.sendMessage({type:"RECORDED_STEP",step:{type:"ASSERT_TEXT",locator:t,innerText:n.substring(0,100),timestamp:Date.now()+1,tagName:i.tagName}});const a=i.style.backgroundColor;return i.style.backgroundColor="rgba(82, 196, 26, 0.3)",void setTimeout(()=>{i.style.backgroundColor=a},500)}const s={type:o.type,locator:e.generateLocator(i),value:i.value,timestamp:Date.now(),tagName:i.tagName,innerText:null===(a=i.innerText)||void 0===a?void 0:a.trim().substring(0,50)};chrome.runtime.sendMessage({type:"RECORDED_STEP",step:s})},!0),document.addEventListener("mouseover",function(e){if(!t||!n)return;const r=e.target;o&&(o.style.outline=""),o=r,o.style.outline="2px solid #52c41a",o.style.outlineOffset="-2px"},!0),document.addEventListener("mouseout",a,!0),document.addEventListener("input",r,!0),document.addEventListener("change",r,!0),console.log("Smart QA Recorder: Content script initialized with Playwright locators")})();